# âš¡ Automated Response System & Advanced Monitoring

## Overview

This document covers the **Automated Response System** and **Advanced Monitoring** features that provide intelligent, automated security responses and real-time threat intelligence.

---

## âš¡ Automated Response System

### Features

#### 1. **Automatic Firewall Rule Generation** ðŸ”¥

Dynamically creates firewall rules based on detected threats without manual intervention.

**Capabilities:**
- Auto-generates rules for blocked IPs
- Temporary and permanent blocking
- Expiration-based rule management
- Priority-based rule application

**Rule Generation Process:**
```javascript
Threat Detected
    â†“
Severity Assessment
    â†“
Penalty Level Assigned
    â†“
Firewall Rule Auto-Generated
    â†“
Rule Applied & Logged
```

**Generated Rule Structure:**
```javascript
{
  id: 'auto_1698246523_abc123',
  type: 'auto-generated',
  sourceIP: '45.142.122.3',
  action: 'drop',
  protocol: 'any',
  direction: 'inbound',
  enabled: true,
  priority: 'high',
  reason: 'Auto-generated: ddos (critical)',
  expiresAt: 1698250123000, // Timestamp or null for permanent
  metadata: {
    violationType: 'ddos',
    severity: 'critical',
    autoGenerated: true,
    canExpire: true
  }
}
```

---

#### 2. **Dynamic IP Reputation Scoring** ðŸ“Š

Real-time reputation calculation for every IP address.

**Reputation Score Range:** 0-100
- **90-100**: Excellent (Trusted)
- **75-89**: Good (Moderate trust)
- **50-74**: Neutral (Low trust)
- **25-49**: Suspicious (Untrusted)
- **10-24**: Bad (High risk)
- **0-9**: Malicious (Critical risk)

**Score Calculation Factors:**

**Positive Indicators (+):**
```
Successful Requests:     +0.5 per request
CAPTCHA Solved:          +2.0 per solve
Good Behavior (7+ days): +0.1 per day
```

**Negative Indicators (-):**
```
Failed Requests:         -1.0 per failure
Blocked Requests:        -5.0 per block
Failed CAPTCHA:          -3.0 per failure
DDoS Detection:          -15.0 per incident
Exploit Detection:       -20.0 per incident
```

**Reputation Tracking:**
```javascript
{
  score: 65,
  category: 'neutral',
  trustLevel: 'moderate',
  firstSeen: 1698246000000,
  lastSeen: 1698246523000,
  requestCount: 1247,
  successfulRequests: 1189,
  failedRequests: 43,
  blockedRequests: 15,
  violationHistory: [
    { type: 'ddos', timestamp: 1698240000000 }
  ],
  penaltyLevel: 2
}
```

---

#### 3. **Progressive Penalties** ðŸ“ˆ

Graduated response system that escalates penalties based on behavior.

**Penalty Levels:**

```
Level 0: CLEAN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Allow
Duration:  N/A
Status:    Normal operation

Level 1: WARNING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Monitor
Duration:  5 minutes
Status:    First violation detected

Level 2: CAUTION  
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Light Throttle
Duration:  15 minutes
Status:    Repeated minor violations

Level 3: SUSPICIOUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Heavy Throttle
Duration:  30 minutes
Status:    Multiple violations

Level 4: HOSTILE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Temporary Block
Duration:  1 hour
Status:    Severe violations

Level 5: MALICIOUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Action:    Permanent Block
Duration:  Permanent
Status:    Critical threat
```

**Penalty Escalation Rules:**

```javascript
Violation Severity Score â†’ Penalty Action

80-100:  Immediate Level 5 (Permanent Block)
60-79:   Increase by 2 levels
40-59:   Increase by 1 level
20-39:   Increase by 1 level (if >3 violations)
0-19:    Maintain current level
```

**Examples:**

```
Example 1: First-time DDoS (High Severity - Score 70)
Current Level: 0 â†’ New Level: 2 (Caution)
Action: Light throttle for 15 minutes

Example 2: Critical Exploit (Score 95)
Current Level: Any â†’ New Level: 5 (Malicious)
Action: Permanent block

Example 3: Repeated Bot Traffic (Score 40)
Current Level: 2 â†’ New Level: 3 (Suspicious)
After 3+ violations
Action: Heavy throttle for 30 minutes
```

---

#### 4. **Whitelist Auto-Learning** ðŸŽ“

Automatically identifies and whitelists legitimate users.

**Learning Criteria:**

```javascript
All conditions must be met:
âœ“ Request Count:      â‰¥1000 successful requests
âœ“ Time Span:          â‰¥24 hours of activity
âœ“ Error Rate:         <5% failed requests
âœ“ Consistency Score:  â‰¥0.8 behavior consistency
âœ“ No Violations:      Zero security incidents
âœ“ High Reputation:    Score â‰¥75
```

**Auto-Whitelist Process:**

```
1. Monitor IP behavior continuously
2. Track success rate and patterns
3. Calculate consistency score
4. Evaluate all criteria
5. If all met â†’ Add to whitelist
6. Remove any existing firewall rules
7. Bypass rate limiting
```

**Consistency Score Calculation:**
```javascript
// Measures behavioral predictability
successRate = successfulRequests / totalRequests
violationPenalty = violations.length * 0.1
consistencyScore = successRate - violationPenalty

Score 0.0-0.4: Inconsistent (Not eligible)
Score 0.5-0.7: Moderate (May qualify)
Score 0.8-1.0: Highly consistent (Qualifies)
```

**Whitelist Entry:**
```javascript
{
  ip: '203.0.113.50',
  addedAt: 1698246523000,
  reason: 'auto-learned',
  reputation: 87,
  requestCount: 2450,
  successRate: 0.96
}
```

---

## ðŸ“Š Advanced Monitoring System

### Features

#### 1. **Real-time Attack Heatmap (Geographic)** ðŸ—ºï¸

Visualize attacks on a world map in real-time.

**Heatmap Data Structure:**
```javascript
{
  country: 'RU',
  countryName: 'Russia',
  coordinates: { lat: 61.5240, lon: 105.3188 },
  attackCount: 347,
  attackTypes: {
    ddos: 234,
    exploit: 87,
    bot: 26
  },
  severity: 'critical',
  intensity: 100,  // 0-100 scale for heat visualization
  riskLevel: 'high'
}
```

**Supported Countries:**
- United States (Low Risk)
- China (High Risk)
- Russia (High Risk)
- North Korea (Critical Risk)
- Iran (High Risk)
- Brazil, India, Vietnam (Medium Risk)
- UK, Germany, France, Japan (Low Risk)

**Intensity Calculation:**
```javascript
intensity = min(100, attackCount * 2)

Intensity Scale:
0-20:   Cool (Light blue)
21-40:  Warm (Yellow)
41-70:  Hot (Orange)
71-100: Critical (Red)
```

**Regional Severity:**
```javascript
Attack Rate Calculation:
attackRate = attackCount / hoursSinceFirstAttack

Severity Levels:
>100 attacks/hour: Critical
>50 attacks/hour:  High
>10 attacks/hour:  Medium
â‰¤10 attacks/hour:  Low
```

---

#### 2. **Attack Prediction Timeline** ðŸ”®

Predicts future attack likelihood using historical patterns.

**Prediction Windows:**
- **5 minutes**: Short-term immediate threats
- **15 minutes**: Medium-term escalation
- **30 minutes**: Long-term trend analysis

**Prediction Output:**
```javascript
{
  timeWindow: 5,  // minutes
  currentRate: 12.4,  // attacks per minute
  predictedRate: 14.9,  // +20% prediction
  confidence: 0.85,  // 0.0-1.0 scale
  likelihood: 'very high',
  topThreats: [
    { type: 'ddos', count: 145 },
    { type: 'bot', count: 87 },
    { type: 'exploit', count: 23 }
  ],
  recommendedAction: 'Activate maximum DDoS protection...'
}
```

**Likelihood Levels:**
```
Attack Rate â†’ Likelihood
>10/min:     Very High
5-10/min:    High
2-5/min:     Moderate
0.5-2/min:   Low
<0.5/min:    Very Low
```

**Confidence Calculation:**
```javascript
Data Points â†’ Confidence
<10:    30%
10-49:  50%
50-99:  70%
â‰¥100:   85%
```

---

#### 3. **Threat Severity Scoring** ðŸŽ¯

Comprehensive scoring system for threat assessment.

**Base Scores by Threat Type:**
```
DDoS:              60
Zero-Day:          80
Exploit:           70
Brute Force:       50
SQL Injection:     75
XSS:               60
Bot Traffic:       40
Slowloris:         65
```

**Score Adjustments:**

**Attack Frequency:**
```
>100 attacks:   +20
50-100 attacks: +15
10-50 attacks:  +10
```

**Source Reputation:**
```
<25 score:   +15
25-50 score: +10
```

**Geographic Risk:**
```
Critical Risk Country: +15
High Risk Country:     +10
Medium Risk Country:   +5
Low Risk Country:      +0
```

**Payload Score:**
```
Payload Analysis Score * 0.2
```

**Final Threat Categories:**
```
Score 0-30:   Informational
Score 30-50:  Routine Monitoring
Score 50-70:  Monitor Closely
Score 70-90:  High Priority
Score 90-100: Immediate Action Required
```

---

#### 4. **Email/SMS Alerts** ðŸ“§ðŸ“±

Automated alert system for critical threats.

**Alert Configuration:**
```javascript
{
  emailEnabled: true,
  smsEnabled: true,
  emailThreshold: 'high',      // Send email for high+ severity
  smsThreshold: 'critical',    // Send SMS for critical only
  cooldownPeriod: 300000,      // 5 min between same-threat alerts
  maxAlertsPerHour: 10         // Rate limit
}
```

**Alert Severity Mapping:**
```
Severity    Email   SMS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Low         âŒ      âŒ
Medium      âŒ      âŒ
High        âœ…      âŒ
Critical    âœ…      âœ…
```

**Email Alert Format:**
```
Subject:
ðŸš¨ Security Alert: DDOS - CRITICAL

Body:
SECURITY ALERT - CRITICAL PRIORITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Threat Type:     ddos
Severity Score:  87/100
Source IP:       45.142.122.3
Country:         Russia
Category:        high-priority
Timestamp:       2025-10-25T14:32:18.000Z

Action Required:
- Immediate investigation required
- IP has been automatically blocked
- Review attack logs immediately
- Contact security team

Recommendation:
Activate maximum DDoS protection

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Nebula Shield Anti-Virus - Security Operations
```

**SMS Alert Format:**
```
ðŸš¨ ALERT: ddos from 45.142.122.3
Severity: CRITICAL (87/100)
```

**Alert Cooldown:**
```
Same IP + Same Threat Type:
- First alert:  Immediate
- Second alert: Wait 5 minutes
- Third alert:  Wait 5 minutes
- Etc...

Purpose: Prevent alert flooding
```

**Rate Limiting:**
```
Maximum 10 alerts per hour
If exceeded:
- Critical alerts still sent
- Lower priority alerts queued
- Alerts aggregated if possible
```

---

## ðŸ”§ Configuration

### Automated Response System Setup

```javascript
// In: src/services/enhancedNetworkProtection.js

const automatedResponse = new AutomatedResponseSystem();

// Configure reputation thresholds
automatedResponse.ipReputations.set('203.0.113.1', {
  score: 50,
  penaltyLevel: 0
});

// Configure whitelist learning
automatedResponse.whitelistThreshold = {
  requestCount: 1000,
  timeSpan: 86400000,
  errorRate: 0.05,
  consistencyScore: 0.8
};

// Get statistics
const stats = automatedResponse.getStats();
```

### Advanced Monitoring Setup

```javascript
// In: backend/advanced-monitoring-system.js

const monitoring = require('./advanced-monitoring-system');

// Configure alert settings
monitoring.alertConfig = {
  emailEnabled: true,
  smsEnabled: true,
  emailThreshold: 'high',
  smsThreshold: 'critical',
  cooldownPeriod: 300000,
  maxAlertsPerHour: 10
};

// Record attack
monitoring.recordAttack({
  type: 'ddos',
  ip: '45.142.122.3',
  severity: 'critical'
});

// Get heatmap
const heatmap = monitoring.getAttackHeatmap();

// Get predictions
const predictions = monitoring.predictAttacks();
```

---

## ðŸ“ˆ Usage Examples

### Example 1: IP Reputation Management

```javascript
// Calculate reputation after successful request
const reputation = automatedResponse.calculateIPReputation(
  '203.0.113.50',
  { successful: true }
);

console.log(reputation);
// {
//   score: 50.5,
//   category: 'neutral',
//   trustLevel: 'moderate',
//   reputation: { ... }
// }
```

### Example 2: Progressive Penalty Application

```javascript
// Apply penalty for DDoS attack
const penalty = automatedResponse.applyProgressivePenalty(
  '45.142.122.3',
  { type: 'ddos', severity: 'high' }
);

console.log(penalty);
// {
//   timestamp: 1698246523000,
//   ip: '45.142.122.3',
//   violation: 'ddos',
//   previousLevel: 0,
//   newLevel: 2,
//   action: 'throttle_heavy',
//   duration: 1800000,
//   expiresAt: 1698248323000
// }
```

### Example 3: Whitelist Auto-Learning

```javascript
// Evaluate IP for whitelisting
const evaluation = automatedResponse.evaluateForWhitelisting('203.0.113.50');

console.log(evaluation);
// {
//   shouldWhitelist: true,
//   reason: 'Automatically learned as legitimate user',
//   criteria: {
//     sufficientRequests: true,
//     sufficientAge: true,
//     lowErrorRate: true,
//     highConsistency: true,
//     noViolations: true,
//     highReputation: true
//   }
// }
```

### Example 4: Attack Heatmap

```javascript
// Get real-time attack heatmap
const heatmap = monitoring.getAttackHeatmap(3600000); // Last hour

console.log(heatmap);
// [
//   {
//     country: 'RU',
//     countryName: 'Russia',
//     coordinates: { lat: 61.5240, lon: 105.3188 },
//     attackCount: 347,
//     attackTypes: { ddos: 234, exploit: 87, bot: 26 },
//     severity: 'critical',
//     intensity: 100,
//     riskLevel: 'high'
//   },
//   ...
// ]
```

### Example 5: Send Alert

```javascript
// Send critical threat alert
const alert = monitoring.sendAlert({
  type: 'zero-day',
  sourceIP: '198.98.57.207',
  severity: 'critical',
  sourceReputation: 15
}, 'email');

console.log(alert);
// {
//   id: 'alert_1698246523_abc123',
//   timestamp: 1698246523000,
//   channel: 'email',
//   threat: { ... },
//   message: { subject: '...', body: '...' },
//   sent: true
// }
```

---

## ðŸ“Š Monitoring Dashboard

### Real-Time Statistics

```
Automated Response System
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Total IPs Tracked:        5,247
Auto-Whitelisted:         312
Active Firewall Rules:    47
Penalty Distribution:
  Clean:                  4,823
  Warning:                197
  Caution:                142
  Suspicious:             58
  Hostile:                19
  Malicious:              8

Advanced Monitoring
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Active Threats:           127
Alerts Sent (24h):        23
Top Attack Country:       Russia (347)
Current Attack Rate:      12.4/min
Predicted Rate (5min):    14.9/min
Threat Likelihood:        Very High
```

---

## ðŸŽ¯ Best Practices

### Automated Response

1. **Monitor reputation scores** regularly
2. **Review auto-generated rules** weekly
3. **Adjust penalty thresholds** based on traffic
4. **Verify whitelist entries** monthly
5. **Clean expired rules** automatically

### Advanced Monitoring

1. **Review heatmap** daily for geographic trends
2. **Check predictions** for proactive defense
3. **Configure alert thresholds** appropriately
4. **Test alert delivery** regularly
5. **Maintain alert contacts** up-to-date

---

## ðŸ“š API Reference

### Automated Response API

```javascript
// IP Reputation
calculateIPReputation(ip, activityHistory)
â†’ Returns: { score, category, trustLevel, reputation }

// Progressive Penalties
applyProgressivePenalty(ip, violation)
â†’ Returns: penalty record object

// Whitelist Learning
evaluateForWhitelisting(ip)
â†’ Returns: { shouldWhitelist, reason, criteria }

// Firewall Rules
generateFirewallRule(ip, penalty, violation)
â†’ Returns: firewall rule object

cleanupExpiredRules()
â†’ Returns: array of expired rules

// Statistics
getStats()
â†’ Returns: comprehensive statistics object
```

### Advanced Monitoring API

```javascript
// Heatmap
getAttackHeatmap(timeRange)
â†’ Returns: array of geographic attack data

// Predictions
predictAttacks()
â†’ Returns: array of predictions by time window

// Threat Severity
calculateThreatSeverity(threat)
â†’ Returns: { score, severity, category, requiresAlert }

// Alerts
sendAlert(threat, channel)
â†’ Returns: alert object

// Statistics
getMonitoringStats()
â†’ Returns: comprehensive monitoring stats
```

---

## ðŸ“– Related Documentation

- [Enhanced DDoS & Zero-Day Protection](./ADVANCED_DDOS_AND_ZERO_DAY_PROTECTION.md)
- [Enhanced Network Protection](./ENHANCED_NETWORK_PROTECTION_DOCUMENTATION.md)
- [Hacker Protection](./HACKER_PROTECTION_DOCUMENTATION.md)

---

**Last Updated**: October 25, 2025  
**Version**: 1.0.0  
**Author**: Nebula Shield Security Team
